<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Online Key Store - Professional Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet"/>
<style>
  :root {
    --clr-bg: #0a0a12;
    --clr-card: #111120;
    --clr-card2: #18181f;
    --clr-border: #2a2a3d;
    --clr-accent: #00e5ff;
    --clr-accent2: #7c4dff;
    --clr-accent3: #ff4081;
    --clr-text: #e0e0ef;
    --clr-text-dim: #6e6e85;
    --clr-success: #00e676;
    --clr-warn: #ffab40;
    --clr-danger: #ff5252;
    --font-head: 'Orbitron', sans-serif;
    --font-body: 'Rajdhani', sans-serif;
    --font-mono: 'Share Tech Mono', monospace;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background: var(--clr-bg);
    color: var(--clr-text);
    font-family: var(--font-body);
    min-height: 100vh;
    overflow-x: hidden;
  }

  .ambient {
    position: fixed; inset:0; z-index:0; pointer-events:none;
    background:
      radial-gradient(ellipse 80% 50% at 20% 80%, rgba(124,77,255,.12) 0%, transparent 70%),
      radial-gradient(ellipse 60% 40% at 85% 20%, rgba(0,229,255,.08) 0%, transparent 70%),
      radial-gradient(ellipse 50% 60% at 50% 50%, rgba(255,64,129,.06) 0%, transparent 70%);
  }
  .grid-overlay {
    position:fixed; inset:0; z-index:0; pointer-events:none; opacity:.035;
    background-image:
      linear-gradient(var(--clr-accent) 1px, transparent 1px),
      linear-gradient(90deg, var(--clr-accent) 1px, transparent 1px);
    background-size: 60px 60px;
  }

  .wrapper { position:relative; z-index:1; min-height:100vh; }

  .header {
    display:flex; align-items:center; justify-content:space-between;
    padding: 18px 28px;
    background: rgba(17,17,32,.85);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--clr-border);
    position: sticky; top:0; z-index:100;
  }
  .logo {
    display:flex; align-items:center; gap:10px;
    font-family: var(--font-head); font-size:18px; font-weight:700;
    color: var(--clr-accent);
    text-shadow: 0 0 18px rgba(0,229,255,.35);
  }
  .logo svg { width:28px; height:28px; }
  .header-actions { display:flex; gap:12px; align-items:center; }

  .btn {
    display:inline-flex; align-items:center; justify-content:center; gap:8px;
    padding: 10px 22px;
    border:none; border-radius:6px; cursor:pointer;
    font-family: var(--font-head); font-size:13px; font-weight:600;
    letter-spacing:1px; text-transform:uppercase;
    transition: all .25s ease;
    position:relative; overflow:hidden;
  }
  .btn::before {
    content:''; position:absolute; inset:0;
    background: linear-gradient(135deg, transparent 40%, rgba(255,255,255,.08) 50%, transparent 60%);
    transform: translateX(-100%);
    transition: transform .5s ease;
  }
  .btn:hover::before { transform: translateX(100%); }

  .btn-primary {
    background: linear-gradient(135deg, var(--clr-accent2), #5c2de8);
    color:#fff;
    box-shadow: 0 4px 20px rgba(124,77,255,.35);
  }
  .btn-primary:hover { box-shadow: 0 6px 30px rgba(124,77,255,.55); transform: translateY(-1px); }

  .btn-ghost {
    background: transparent;
    border: 1px solid var(--clr-border);
    color: var(--clr-text);
  }
  .btn-ghost:hover { border-color: var(--clr-accent); color: var(--clr-accent); }

  .btn-accent {
    background: linear-gradient(135deg, var(--clr-accent), #00bcd4);
    color: #0a0a12;
    box-shadow: 0 4px 18px rgba(0,229,255,.3);
  }
  .btn-accent:hover { box-shadow: 0 6px 28px rgba(0,229,255,.5); transform: translateY(-1px); }

  .btn-danger {
    background: linear-gradient(135deg, #ff5252, #d32f2f);
    color:#fff;
  }

  .btn-sm { padding:6px 14px; font-size:11px; }
  .btn-block { width:100%; padding:14px; font-size:15px; }

  .page { display:none; animation: fadeIn .4s ease; }
  .page.active { display:block; }
  @keyframes fadeIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

  .hero {
    text-align:center; padding: 70px 20px 50px;
  }
  .hero-badge {
    display:inline-block; padding:6px 16px;
    border:1px solid var(--clr-accent); border-radius:20px;
    font-size:12px; color: var(--clr-accent); letter-spacing:2px;
    text-transform:uppercase; margin-bottom:22px;
    background: rgba(0,229,255,.07);
  }
  .hero h1 {
    font-family: var(--font-head); font-size: clamp(28px,6vw,52px);
    font-weight:900; line-height:1.1; margin-bottom:16px;
    background: linear-gradient(135deg, var(--clr-accent), var(--clr-accent2), var(--clr-accent3));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .hero p { color: var(--clr-text-dim); font-size:17px; max-width:520px; margin:0 auto 32px; line-height:1.6; }

  .card {
    background: var(--clr-card);
    border:1px solid var(--clr-border);
    border-radius:12px;
    padding:28px;
    position:relative;
    transition: border-color .3s, box-shadow .3s;
  }
  .card:hover { border-color: var(--clr-accent2); box-shadow: 0 0 24px rgba(124,77,255,.12); }
  .card-header {
    display:flex; align-items:center; gap:10px; margin-bottom:18px;
  }
  .card-header h3 { font-family: var(--font-head); font-size:15px; color:#fff; }
  .card-icon {
    width:36px; height:36px; border-radius:8px;
    display:flex; align-items:center; justify-content:center;
    font-size:16px;
  }
  .icon-purple { background: rgba(124,77,255,.15); }
  .icon-cyan { background: rgba(0,229,255,.15); }
  .icon-pink { background: rgba(255,64,129,.15); }
  .icon-green { background: rgba(0,230,118,.15); }

  .form-group { margin-bottom:20px; }
  .form-group label {
    display:block; font-size:13px; color: var(--clr-text-dim);
    margin-bottom:8px; letter-spacing:.5px; text-transform:uppercase;
    font-family: var(--font-head); font-weight:600;
  }
  .form-group .label-icon { margin-right:6px; }

  select, input, textarea {
    width:100%;
    background: var(--clr-card2);
    border:1px solid var(--clr-border);
    border-radius:8px;
    padding: 13px 16px;
    color: var(--clr-text);
    font-family: var(--font-body); font-size:15px;
    transition: border-color .25s, box-shadow .25s;
    outline:none;
    appearance:none; -webkit-appearance:none;
  }
  select:focus, input:focus, textarea:focus {
    border-color: var(--clr-accent2);
    box-shadow: 0 0 0 3px rgba(124,77,255,.18);
  }
  select { 
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%237c4dff' d='M6 8L1 3h10z'/%3E%3C/svg%3E"); 
    background-repeat:no-repeat; 
    background-position: right 14px center; 
    padding-right:40px; 
  }
  select option { background: var(--clr-card); color: var(--clr-text); }

  .coupon-wrap {
    display:flex; gap:10px; align-items:center;
  }
  .coupon-wrap input { flex:1; }

  .price-display {
    text-align:center; padding: 18px 0 10px;
  }
  .price-display .old-price { font-size:15px; color: var(--clr-text-dim); text-decoration:line-through; }
  .price-display .new-price {
    font-family: var(--font-head); font-size:36px; font-weight:900; color: var(--clr-accent);
    text-shadow: 0 0 18px rgba(0,229,255,.3);
  }
  .price-display .price-label { font-size:13px; color: var(--clr-text-dim); margin-top:4px; }

  .plan-row { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:14px; }
  .plan-card {
    border:2px solid var(--clr-border);
    border-radius:10px; padding:18px 12px; text-align:center;
    cursor:pointer; transition: all .25s;
    background: var(--clr-card2);
  }
  .plan-card:hover { border-color: var(--clr-accent2); }
  .plan-card.selected {
    border-color: var(--clr-accent);
    background: rgba(0,229,255,.06);
    box-shadow: 0 0 16px rgba(0,229,255,.15);
  }
  .plan-card .plan-name { font-family: var(--font-head); font-size:13px; color:#fff; margin-bottom:6px; }
  .plan-card .plan-price { font-family: var(--font-head); font-size:22px; color: var(--clr-accent); font-weight:700; }
  .plan-card .plan-dur { font-size:12px; color: var(--clr-text-dim); margin-top:4px; }
  .plan-card .popular-tag {
    display:inline-block; font-size:10px; background: var(--clr-accent3); color:#fff;
    padding:2px 8px; border-radius:10px; margin-bottom:6px; letter-spacing:1px;
  }

  .modal-overlay {
    display:none; position:fixed; inset:0; z-index:500;
    background: rgba(0,0,0,.7); backdrop-filter: blur(4px);
    align-items:center; justify-content:center;
  }
  .modal-overlay.open { display:flex; }
  .modal {
    background: var(--clr-card); border:1px solid var(--clr-border);
    border-radius:16px; padding:36px; width:90%; max-width:420px;
    text-align:center; position:relative;
    animation: modalIn .3s cubic-bezier(.34,1.56,.64,1);
  }
  @keyframes modalIn { from { transform:scale(.88); opacity:0; } to { transform:scale(1); opacity:1; } }
  .modal-close {
    position:absolute; top:14px; right:18px;
    background:none; border:none; color: var(--clr-text-dim);
    font-size:22px; cursor:pointer; transition:color .2s;
  }
  .modal-close:hover { color: var(--clr-accent3); }
  .modal h3 { font-family: var(--font-head); font-size:18px; color:#fff; margin-bottom:8px; }
  .modal p { color: var(--clr-text-dim); font-size:14px; margin-bottom:20px; }
  .upi-box {
    background: var(--clr-card2); border:1px dashed var(--clr-accent);
    border-radius:10px; padding:22px; margin-bottom:18px;
  }
  .upi-box .upi-id { font-family: var(--font-mono); font-size:18px; color: var(--clr-accent); margin-bottom:6px; }
  .upi-box .upi-amt { font-family: var(--font-head); font-size:28px; color:#fff; }
  .upi-note { font-size:12px; color: var(--clr-text-dim); margin-bottom:20px; }
  .upi-note code { color: var(--clr-warn); background: rgba(255,171,64,.1); padding:2px 6px; border-radius:4px; }

  .key-box {
    background: linear-gradient(135deg, rgba(0,230,118,.08), rgba(0,229,255,.06));
    border:1px solid rgba(0,230,118,.25);
    border-radius:12px; padding:24px; margin:16px 0;
  }
  .key-box .key-label { font-size:12px; color: var(--clr-success); letter-spacing:2px; text-transform:uppercase; margin-bottom:8px; font-family: var(--font-head); }
  .key-box .key-value {
    font-family: var(--font-mono); font-size:17px; color:#fff;
    word-break:break-all; letter-spacing:1px;
    background: rgba(0,0,0,.3); padding:12px 14px; border-radius:8px;
  }
  .key-box .key-game { font-size:13px; color: var(--clr-text-dim); margin-top:10px; }
  .pulse-dot {
    display:inline-block; width:8px; height:8px; border-radius:50%;
    background: var(--clr-success);
    box-shadow: 0 0 8px var(--clr-success);
    animation: pulse 1.4s infinite;
  }
  @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:.4;} }

  .container { max-width:500px; margin:0 auto; padding:0 20px 60px; }

  .admin-nav {
    display:flex; gap:8px; flex-wrap:wrap; padding:18px 20px 0;
    max-width:900px; margin:0 auto;
  }
  .admin-tab {
    padding:9px 18px; background: var(--clr-card2);
    border:1px solid var(--clr-border); border-radius:8px;
    color: var(--clr-text-dim); font-family: var(--font-head); font-size:12px;
    cursor:pointer; transition:all .25s; letter-spacing:.5px;
  }
  .admin-tab:hover { border-color: var(--clr-accent2); color: var(--clr-text); }
  .admin-tab.active { border-color: var(--clr-accent); color: var(--clr-accent); background: rgba(0,229,255,.07); }

  .admin-body { max-width:900px; margin:0 auto; padding:24px 20px 60px; }

  .table-wrap { overflow-x:auto; border-radius:10px; border:1px solid var(--clr-border); }
  table { width:100%; border-collapse:collapse; }
  th {
    background: var(--clr-card2); padding:12px 16px; text-align:left;
    font-family: var(--font-head); font-size:11px; color: var(--clr-text-dim);
    letter-spacing:1px; text-transform:uppercase; border-bottom:1px solid var(--clr-border);
    white-space:nowrap;
  }
  td { padding:12px 16px; border-bottom:1px solid rgba(42,42,61,.5); font-size:14px; white-space:nowrap; }
  tr:last-child td { border-bottom:none; }
  tr:hover td { background: rgba(124,77,255,.04); }

  .status-badge {
    display:inline-flex; align-items:center; gap:5px;
    padding:4px 10px; border-radius:14px; font-size:12px; font-family: var(--font-mono);
  }
  .status-success { background: rgba(0,230,118,.1); color: var(--clr-success); }
  .status-pending { background: rgba(255,171,64,.1); color: var(--clr-warn); }

  .login-screen {
    max-width:380px; margin:80px auto 0; padding:0 20px;
  }
  .login-screen .card { padding:36px 28px; }
  .login-screen h2 { font-family: var(--font-head); font-size:20px; text-align:center; color:#fff; margin-bottom:6px; }
  .login-screen p { text-align:center; color: var(--clr-text-dim); font-size:14px; margin-bottom:24px; }
  .error-msg {
    background: rgba(255,82,82,.1); border:1px solid rgba(255,82,82,.25);
    color: var(--clr-danger); padding:8px 12px; border-radius:6px;
    font-size:13px; display:none; margin-bottom:14px; text-align:center;
  }
  .error-msg.show { display:block; }

  .divider { height:1px; background: var(--clr-border); margin:20px 0; }

  .toast {
    position:fixed; bottom:24px; left:50%; transform:translateX(-50%) translateY(80px);
    background: var(--clr-card); border:1px solid var(--clr-accent);
    border-radius:10px; padding:12px 24px;
    color: var(--clr-accent); font-family: var(--font-body); font-size:15px;
    z-index:600; transition: transform .35s cubic-bezier(.34,1.56,.64,1);
    display:flex; align-items:center; gap:10px;
    box-shadow: 0 8px 30px rgba(0,0,0,.4);
  }
  .toast.show { transform:translateX(-50%) translateY(0); }

  .stats-row { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:14px; margin-bottom:24px; }
  .stat-card {
    background: var(--clr-card); border:1px solid var(--clr-border);
    border-radius:10px; padding:18px;
  }
  .stat-card .stat-val { font-family: var(--font-head); font-size:26px; color: var(--clr-accent); font-weight:700; }
  .stat-card .stat-label { font-size:12px; color: var(--clr-text-dim); margin-top:4px; }

  .key-section { 
    background: var(--clr-card2); 
    border:1px solid var(--clr-border);
    border-radius:10px; 
    padding:20px; 
    margin-bottom:16px;
  }
  .key-section h4 { 
    font-family: var(--font-head); 
    font-size:14px; 
    color: var(--clr-accent); 
    margin-bottom:12px;
    display:flex;
    align-items:center;
    gap:8px;
  }
  .key-section textarea {
    font-family: var(--font-mono); 
    font-size:13px; 
    line-height:1.8;
    min-height:120px; 
    resize:vertical; 
    letter-spacing:.5px;
  }
  .key-count { 
    font-size:11px; 
    color: var(--clr-text-dim); 
    margin-top:6px;
    font-family: var(--font-mono);
  }

  ::-webkit-scrollbar { width:6px; }
  ::-webkit-scrollbar-track { background: var(--clr-bg); }
  ::-webkit-scrollbar-thumb { background: var(--clr-border); border-radius:3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--clr-accent2); }

  @media(max-width:500px){
    .header { padding:14px 16px; }
    .logo span { font-size:15px; }
    .hero { padding:40px 16px 30px; }
    .plan-row { grid-template-columns:repeat(auto-fill,minmax(100px,1fr)); }
    .stats-row { grid-template-columns:repeat(2,1fr); }
  }

  .scanlines {
    position:fixed; inset:0; z-index:9999; pointer-events:none;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0,0,0,.03) 2px,
      rgba(0,0,0,.03) 4px
    );
  }
</style>
</head>
<body>

<div class="ambient"></div>
<div class="grid-overlay"></div>
<div class="scanlines"></div>

<div class="toast" id="toast">‚úì <span id="toast-msg">Done!</span></div>

<!-- USER SIDE -->
<div id="user-wrapper" class="wrapper">
  <header class="header">
    <div class="logo">
      <svg viewBox="0 0 28 28" fill="none"><rect x="2" y="8" width="16" height="12" rx="3" stroke="#00e5ff" stroke-width="2"/><circle cx="7" cy="14" r="2" fill="#00e5ff"/><path d="M18 12v4l4 2V10l-4 2z" fill="#7c4dff"/></svg>
      <span>Online Key Store</span>
    </div>
    <div class="header-actions">
      <button class="btn btn-ghost btn-sm" onclick="openAdmin()">‚öô Admin</button>
    </div>
  </header>

  <section class="hero">
    <div class="hero-badge">üîê Secure Key Platform</div>
    <h1>Purchase Your<br/>Game Key Instantly</h1>
    <p>Unique, verified keys delivered in seconds. Powered by automated systems & UPI payments.</p>
  </section>

  <div class="container">
    <div class="card">
      <div class="form-group">
        <label><span class="label-icon">üéÆ</span> Select Brand</label>
        <select id="brandSelect" onchange="onBrandChange()">
          <option value="">‚Äî Choose a brand ‚Äî</option>
          <option value="BGMI">BGMI Loader</option>
          <option value="Voltage">Voltage Loader</option>
          <option value="Infinite">Infinite Mod</option>
        </select>
      </div>

      <div class="form-group">
        <label><span class="label-icon">‚è±</span> Select Plan</label>
        <div class="plan-row" id="planRow">
          <div style="color:var(--clr-text-dim);font-size:14px;padding:10px 0;">Select a brand first</div>
        </div>
      </div>

      <div class="form-group">
        <label><span class="label-icon">üè∑</span> Coupon Code</label>
        <div class="coupon-wrap">
          <input type="text" id="couponInput" placeholder="Enter coupon code‚Ä¶" style="text-transform:uppercase;" oninput="this.value=this.value.toUpperCase()"/>
          <button class="btn btn-ghost btn-sm" onclick="applyCoupon()">Apply</button>
        </div>
        <div id="couponMsg" style="margin-top:8px;font-size:13px;display:none;"></div>
      </div>

      <div class="price-display" id="priceDisplay" style="display:none;">
        <div class="old-price" id="oldPrice"></div>
        <div class="new-price" id="newPrice">‚Çπ0</div>
        <div class="price-label" id="priceLabel">per plan</div>
      </div>

      <div class="divider"></div>

      <button class="btn btn-primary btn-block" onclick="purchaseKey()">
        üîë &nbsp; Purchase Key
      </button>
    </div>
  </div>
</div>

<!-- ADMIN SIDE -->
<div id="admin-wrapper" class="wrapper" style="display:none;">
  <div id="admin-login" class="login-screen">
    <div class="card">
      <div style="text-align:center;margin-bottom:18px;">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
          <rect x="4" y="14" width="28" height="20" rx="5" stroke="#7c4dff" stroke-width="2.5"/>
          <circle cx="12" cy="24" r="3" fill="#7c4dff"/>
          <path d="M32 20v8l8 4V16l-8 4z" fill="#00e5ff"/>
        </svg>
      </div>
      <h2>Admin Panel</h2>
      <p>Secure access ‚Äî authorized users only</p>
      <div class="error-msg" id="loginError">Invalid password. Try again.</div>
      <div class="form-group">
        <label>Username</label>
        <input type="text" id="adminUser" placeholder="admin" value="admin"/>
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="adminPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter')adminLogin()"/>
      </div>
      <button class="btn btn-primary btn-block" onclick="adminLogin()">Login</button>
      <div style="margin-top:18px;text-align:center;">
        <button class="btn btn-ghost btn-sm" onclick="closeAdmin()">‚Üê Back to Store</button>
      </div>
    </div>
  </div>

  <div id="admin-dashboard" style="display:none;">
    <header class="header">
      <div class="logo">
        <svg viewBox="0 0 28 28" fill="none"><rect x="2" y="8" width="16" height="12" rx="3" stroke="#00e5ff" stroke-width="2"/><circle cx="7" cy="14" r="2" fill="#00e5ff"/><path d="M18 12v4l4 2V10l-4 2z" fill="#7c4dff"/></svg>
        <span>Admin Panel</span>
      </div>
      <div class="header-actions">
        <button class="btn btn-danger btn-sm" onclick="adminLogout()">Logout</button>
      </div>
    </header>

    <div class="admin-nav">
      <button class="admin-tab active" onclick="switchTab('dashboard')">üìä Dashboard</button>
      <button class="admin-tab" onclick="switchTab('keys')">üîë Key Management</button>
      <button class="admin-tab" onclick="switchTab('transactions')">üí≥ Transactions</button>
    </div>

    <div class="admin-body">
      <!-- DASHBOARD -->
      <div class="page active" id="tab-dashboard">
        <div class="stats-row">
          <div class="stat-card">
            <div class="stat-val" id="statTotal">0</div>
            <div class="stat-label">Total Transactions</div>
          </div>
          <div class="stat-card">
            <div class="stat-val" style="color:var(--clr-success);" id="statRevenue">‚Çπ0</div>
            <div class="stat-label">Total Revenue</div>
          </div>
          <div class="stat-card">
            <div class="stat-val" style="color:var(--clr-accent2);" id="statKeys">0</div>
            <div class="stat-label">Keys Available</div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <div class="card-icon icon-cyan">üìã</div>
            <h3>Recent Transactions</h3>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Time</th><th>User</th><th>Brand</th><th>Plan</th><th>Amount</th><th>Status</th></tr></thead>
              <tbody id="recentBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- KEY MANAGEMENT -->
      <div class="page" id="tab-keys">
        <div class="card">
          <div class="card-header">
            <div class="card-icon icon-purple">üîë</div>
            <h3>Key Management System</h3>
          </div>
          
          <div class="form-group">
            <label>Select Brand</label>
            <select id="keyBrand" onchange="loadKeysBrand()">
              <option value="BGMI">BGMI Loader</option>
              <option value="Voltage">Voltage Loader</option>
              <option value="Infinite">Infinite Mod</option>
            </select>
          </div>

          <div id="keyInputSections"></div>

          <button class="btn btn-accent btn-block" onclick="saveAllKeys()">üíæ &nbsp; Save All Keys</button>
        </div>
      </div>

      <!-- TRANSACTIONS -->
      <div class="page" id="tab-transactions">
        <div class="card">
          <div class="card-header">
            <div class="card-icon icon-pink">üí≥</div>
            <h3>All Transactions</h3>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>ID</th><th>Time</th><th>User</th><th>Brand</th><th>Plan</th><th>Amount</th><th>Key</th><th>Status</th></tr></thead>
              <tbody id="txnBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- UPI MODAL -->
<div class="modal-overlay" id="upiModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('upiModal')">‚úï</button>
    <h3>üí≥ Complete Payment</h3>
    <p>Send exact amount to UPI ID below</p>
    <div class="upi-box">
      <div class="upi-id">store@upi</div>
      <div class="upi-amt" id="upiAmt">‚Çπ99</div>
    </div>
    <div class="upi-note">Reference: <code id="upiRef">TXN-XXXX</code></div>
    <button class="btn btn-accent btn-block" onclick="confirmPayment()">‚úì &nbsp; Payment Done ‚Äì Get Key</button>
  </div>
</div>

<!-- KEY DELIVERY MODAL -->
<div class="modal-overlay" id="keyModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('keyModal')">‚úï</button>
    <h3>üéâ Key Delivered!</h3>
    <div class="key-box">
      <div class="key-label"><span class="pulse-dot"></span> &nbsp; Your Key</div>
      <div class="key-value" id="deliveredKey">KEY-XXXX-YYYY-ZZZZ</div>
      <div class="key-game" id="keyGameInfo">BGMI ‚Äî Daily</div>
    </div>
    <button class="btn btn-accent" onclick="copyKey()" style="width:100%;">üìã Copy Key</button>
  </div>
</div>

<script>
// DATA STRUCTURE
const DATA = {
  brands: {
    "BGMI": { 
      plans: { 
        "5Hour": {price:50, dur:"5 Hours"},
        "Daily": {price:200, dur:"24 Hours"}, 
        "Weekly": {price:600, dur:"7 Days", popular:true}, 
        "30Days": {price:999, dur:"30 Days"},
        "60Days": {price:1400, dur:"60 Days"}
      } 
    },
    "Voltage": { 
      plans: { 
        "Daily": {price:150, dur:"24 Hours"}, 
        "Weekly": {price:500, dur:"7 Days", popular:true}, 
        "30Days": {price:999, dur:"30 Days"},
        "60Days": {price:1300, dur:"60 Days"}
      } 
    },
    "Infinite": { 
      plans: { 
        "Daily": {price:200, dur:"24 Hours"}, 
        "Weekly": {price:700, dur:"7 Days", popular:true}, 
        "30Days": {price:1100, dur:"30 Days"},
        "60Days": {price:1700, dur:"60 Days"}
      } 
    }
  },
  keys: {
    "BGMI": {
      "5Hour": [],
      "Daily": [],
      "Weekly": [],
      "30Days": [],
      "60Days": []
    },
    "Voltage": {
      "Daily": [],
      "Weekly": [],
      "30Days": [],
      "60Days": []
    },
    "Infinite": {
      "Daily": [],
      "Weekly": [],
      "30Days": [],
      "60Days": []
    }
  },
  transactions: [],
  coupons: { "SAVE10":10, "WELCOME20":20 },
  adminUsers: [{user:"admin",pass:"admin123"}],
  selectedBrand: null,
  selectedPlan: null,
  couponApplied: null,
  pendingPayment: null
};

// BRAND CHANGE
function onBrandChange(){
  const b = document.getElementById('brandSelect').value;
  DATA.selectedBrand = b || null;
  DATA.selectedPlan = null;
  DATA.couponApplied = null;
  hideCouponMsg();
  renderPlans();
  updatePrice();
}

// RENDER PLANS
function renderPlans(){
  const row = document.getElementById('planRow');
  if(!DATA.selectedBrand){ 
    row.innerHTML='<div style="color:var(--clr-text-dim);font-size:14px;padding:10px 0;">Select a brand first</div>'; 
    return; 
  }
  const plans = DATA.brands[DATA.selectedBrand].plans;
  row.innerHTML = Object.entries(plans).map(([name,p])=>`
    <div class="plan-card ${DATA.selectedPlan===name?'selected':''}" onclick="selectPlan('${name}')">
      ${p.popular?'<div class="popular-tag">üî• Popular</div>':''}
      <div class="plan-name">${name}</div>
      <div class="plan-price">‚Çπ${p.price}</div>
      <div class="plan-dur">${p.dur}</div>
    </div>
  `).join('');
}

function selectPlan(name){
  DATA.selectedPlan = name;
  renderPlans();
  updatePrice();
}

// PRICE UPDATE
function updatePrice(){
  const disp = document.getElementById('priceDisplay');
  if(!DATA.selectedBrand || !DATA.selectedPlan){ 
    disp.style.display='none'; 
    return; 
  }
  const p = DATA.brands[DATA.selectedBrand].plans[DATA.selectedPlan];
  let base = p.price, final = base;
  if(DATA.couponApplied){ 
    final = Math.round(base * (1 - DATA.coupons[DATA.couponApplied]/100)); 
  }
  disp.style.display='block';
  document.getElementById('oldPrice').style.display = DATA.couponApplied ? 'block' : 'none';
  document.getElementById('oldPrice').textContent = `‚Çπ${base}`;
  document.getElementById('newPrice').textContent = `‚Çπ${final}`;
  document.getElementById('priceLabel').textContent = DATA.selectedPlan + ' ‚Äî ' + p.dur;
}

// COUPON
function applyCoupon(){
  const code = document.getElementById('couponInput').value.trim();
  const msg = document.getElementById('couponMsg');
  if(!code){ 
    showCouponMsg('Enter a coupon code first','var(--clr-danger)'); 
    return; 
  }
  if(DATA.coupons[code]!==undefined){
    DATA.couponApplied = code;
    showCouponMsg(`üéâ Code applied! ${DATA.coupons[code]}% off`, 'var(--clr-success)');
    updatePrice();
  } else {
    DATA.couponApplied = null;
    showCouponMsg('Invalid coupon code.','var(--clr-danger)');
    updatePrice();
  }
}
function showCouponMsg(txt,color){
  const m = document.getElementById('couponMsg');
  m.textContent = txt; 
  m.style.color = color; 
  m.style.display='block';
}
function hideCouponMsg(){ 
  document.getElementById('couponMsg').style.display='none'; 
  document.getElementById('couponInput').value=''; 
}

// PURCHASE KEY
function purchaseKey(){
  if(!DATA.selectedBrand){ 
    showToast('Please select a brand'); 
    return; 
  }
  if(!DATA.selectedPlan){ 
    showToast('Please select a plan'); 
    return; 
  }
  
  // Check if keys available for this specific plan
  const availableKeys = DATA.keys[DATA.selectedBrand][DATA.selectedPlan];
  if(!availableKeys || availableKeys.length === 0){
    showToast('No keys available for this plan - Contact support');
    return;
  }

  const p = DATA.brands[DATA.selectedBrand].plans[DATA.selectedPlan];
  let final = p.price;
  if(DATA.couponApplied) {
    final = Math.round(p.price * (1 - DATA.coupons[DATA.couponApplied]/100));
  }
  
  document.getElementById('upiAmt').textContent = `‚Çπ${final}`;
  const ref = 'TXN-' + Math.floor(Math.random()*90000+10000);
  document.getElementById('upiRef').textContent = ref;
  
  // Store pending payment info
  DATA.pendingPayment = {
    ref: ref,
    brand: DATA.selectedBrand,
    plan: DATA.selectedPlan,
    amount: final,
    userId: 'USR-' + Math.random().toString(36).substr(2,6).toUpperCase()
  };
  
  openModal('upiModal');
}

// CONFIRM PAYMENT
function confirmPayment(){
  closeModal('upiModal');
  
  if(!DATA.pendingPayment){
    showToast('Payment error - please try again');
    return;
  }

  const payment = DATA.pendingPayment;
  const availableKeys = DATA.keys[payment.brand][payment.plan];
  
  if(!availableKeys || availableKeys.length === 0){
    showToast('No keys available for this plan');
    DATA.pendingPayment = null;
    return;
  }

  // Get and remove the key from the specific plan
  const key = availableKeys.shift();
  
  // Record transaction
  DATA.transactions.push({
    id: payment.ref,
    time: new Date().toLocaleTimeString(),
    userId: payment.userId,
    brand: payment.brand,
    plan: payment.plan,
    amount: payment.amount,
    key: key,
    status: 'Success'
  });

  // Show key to user
  document.getElementById('deliveredKey').textContent = key;
  document.getElementById('keyGameInfo').textContent = `${payment.brand} ‚Äî ${payment.plan}`;
  openModal('keyModal');
  
  // Clear pending payment
  DATA.pendingPayment = null;
  
  // Reset selection
  DATA.selectedBrand = null;
  DATA.selectedPlan = null;
  DATA.couponApplied = null;
  document.getElementById('brandSelect').value = '';
  hideCouponMsg();
  renderPlans();
  updatePrice();
}

function copyKey(){
  const k = document.getElementById('deliveredKey').textContent;
  navigator.clipboard.writeText(k).then(()=>showToast('Key copied to clipboard!'));
}

// MODALS
function openModal(id){ 
  document.getElementById(id).classList.add('open'); 
}
function closeModal(id){ 
  document.getElementById(id).classList.remove('open'); 
}

// ADMIN
function openAdmin(){
  document.getElementById('user-wrapper').style.display='none';
  document.getElementById('admin-wrapper').style.display='block';
}
function closeAdmin(){
  document.getElementById('admin-wrapper').style.display='none';
  document.getElementById('user-wrapper').style.display='block';
}

let adminLoggedIn = false;
function adminLogin(){
  const u = document.getElementById('adminUser').value.trim();
  const p = document.getElementById('adminPass').value.trim();
  const match = DATA.adminUsers.find(a=>a.user===u && a.pass===p);
  if(match){
    adminLoggedIn = true;
    document.getElementById('admin-login').style.display='none';
    document.getElementById('admin-dashboard').style.display='block';
    refreshAdminData();
    showToast('Welcome, '+u+'!');
  } else {
    document.getElementById('loginError').classList.add('show');
    setTimeout(()=>document.getElementById('loginError').classList.remove('show'),2500);
  }
}
function adminLogout(){
  adminLoggedIn = false;
  document.getElementById('admin-dashboard').style.display='none';
  document.getElementById('admin-login').style.display='block';
  document.getElementById('adminPass').value='';
  closeAdmin();
}

// TABS
function switchTab(name){
  document.querySelectorAll('.admin-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('tab-'+name).classList.add('active');
  refreshAdminData();
}

// REFRESH ADMIN DATA
function refreshAdminData(){
  const rev = DATA.transactions.filter(t=>t.status==='Success').reduce((s,t)=>s+t.amount,0);
  const totalKeys = Object.values(DATA.keys).reduce((total, brand) => {
    return total + Object.values(brand).reduce((sum, arr) => sum + arr.length, 0);
  }, 0);
  
  document.getElementById('statTotal').textContent = DATA.transactions.length;
  document.getElementById('statRevenue').textContent = '‚Çπ'+rev;
  document.getElementById('statKeys').textContent = totalKeys;

  // Recent transactions
  const tbody1 = document.getElementById('recentBody');
  const rows = DATA.transactions.slice().reverse().slice(0,10).map(t=>`
    <tr>
      <td>${t.time}</td>
      <td>${t.userId}</td>
      <td>${t.brand}</td>
      <td>${t.plan}</td>
      <td>‚Çπ${t.amount}</td>
      <td><span class="status-badge status-success">${t.status}</span></td>
    </tr>
  `);
  tbody1.innerHTML = rows.length ? rows.join('') : '<tr><td colspan="6" style="color:var(--clr-text-dim);padding:20px;">No transactions yet</td></tr>';

  // All transactions
  const tbody2 = document.getElementById('txnBody');
  const allRows = DATA.transactions.slice().reverse().map(t=>`
    <tr>
      <td>${t.id}</td>
      <td>${t.time}</td>
      <td>${t.userId}</td>
      <td>${t.brand}</td>
      <td>${t.plan}</td>
      <td>‚Çπ${t.amount}</td>
      <td><code style="font-size:11px;color:var(--clr-text-dim);" onclick="navigator.clipboard.writeText('${t.key}');showToast('Copied!')">${t.key.substring(0,15)}...</code></td>
      <td><span class="status-badge status-success">${t.status}</span></td>
    </tr>
  `);
  tbody2.innerHTML = allRows.length ? allRows.join('') : '<tr><td colspan="8" style="color:var(--clr-text-dim);padding:20px;">No transactions yet</td></tr>';

  // Load key sections
  loadKeysBrand();
}

// KEY MANAGEMENT
function loadKeysBrand(){
  const brand = document.getElementById('keyBrand').value;
  const container = document.getElementById('keyInputSections');
  const plans = DATA.brands[brand].plans;
  
  container.innerHTML = Object.entries(plans).map(([planName, planData]) => {
    const currentKeys = DATA.keys[brand][planName] || [];
    return `
      <div class="key-section">
        <h4>
          <span>${planName} (${planData.dur})</span>
          <span style="margin-left:auto;font-size:12px;color:var(--clr-success);">${currentKeys.length} keys available</span>
        </h4>
        <textarea id="keys_${brand}_${planName}" placeholder="Paste keys here (one per line)&#10;KEY-${brand.toUpperCase()}-${planName.toUpperCase()}-XXXX-YYYY&#10;KEY-${brand.toUpperCase()}-${planName.toUpperCase()}-AAAA-BBBB"></textarea>
        <div class="key-count" id="count_${brand}_${planName}">0 new keys</div>
      </div>
    `;
  }).join('');

  // Add input listeners
  Object.keys(plans).forEach(planName => {
    const textarea = document.getElementById(`keys_${brand}_${planName}`);
    const counter = document.getElementById(`count_${brand}_${planName}`);
    if(textarea && counter){
      textarea.addEventListener('input', function(){
        const lines = this.value.split('\n').filter(l=>l.trim());
        counter.textContent = `${lines.length} new key${lines.length!==1?'s':''}`;
      });
    }
  });
}

function saveAllKeys(){
  const brand = document.getElementById('keyBrand').value;
  const plans = DATA.brands[brand].plans;
  let totalAdded = 0;
  let totalDupes = 0;

  Object.keys(plans).forEach(planName => {
    const textarea = document.getElementById(`keys_${brand}_${planName}`);
    if(!textarea) return;

    const lines = textarea.value.split('\n').map(l=>l.trim()).filter(Boolean);
    const existing = DATA.keys[brand][planName];
    
    lines.forEach(key => {
      if(existing.includes(key)){
        totalDupes++;
      } else {
        existing.push(key);
        totalAdded++;
      }
    });

    textarea.value = '';
    const counter = document.getElementById(`count_${brand}_${planName}`);
    if(counter) counter.textContent = '0 new keys';
  });

  refreshAdminData();
  showToast(`${totalAdded} key(s) added${totalDupes?' ('+totalDupes+' duplicates skipped)':''}`);
}

// TOAST
function showToast(msg){
  document.getElementById('toast-msg').textContent = msg;
  const t = document.getElementById('toast');
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2500);
}

// Initialize
document.addEventListener('DOMContentLoaded', function(){
  // Seed some demo keys
  Object.keys(DATA.keys).forEach(brand => {
    Object.keys(DATA.keys[brand]).forEach(plan => {
      for(let i=0; i<3; i++){
        DATA.keys[brand][plan].push(
          `KEY-${brand.toUpperCase()}-${plan.toUpperCase()}-${Math.random().toString(36).substr(2,4).toUpperCase()}-${Math.random().toString(36).substr(2,4).toUpperCase()}`
        );
      }
    });
  });
});
</script>
</body>
</html>
